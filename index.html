<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>தமிழ் வினாடி-வினா - Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Mukta+Mahee:wght@400;700&family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #1e3799 0%, #009432 100%);
            --secondary-color: #0652DD;
            --success: #00b894;
            --error: #d63031;
            --body-bg: #f8f9fa;
        }

        body {
            font-family: 'Mukta Mahee', 'Noto Sans Tamil', sans-serif;
            background-color: var(--body-bg);
            margin: 0;
            padding: 10px;
            display: flex;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
        }

        .quiz-card {
            background: white;
            width: 100%;
            max-width: 600px;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-top: 8px solid #1e3799;
        }

        h1 {
            color: #2f3542;
            text-align: center;
            font-size: 26px;
            margin-bottom: 20px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: #f1f2f6;
            padding: 10px 20px;
            border-radius: 50px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .meta-info {
            font-size: 13px;
            color: #747d8c;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        #q-text {
            font-size: 20px;
            color: #2f3542;
            line-height: 1.6;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .option-btn {
            background: white;
            border: 2px solid #dfe4ea;
            padding: 14px 18px;
            width: 100%;
            margin-bottom: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 17px;
            text-align: left;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .option-btn:hover:not([disabled]) {
            border-color: var(--secondary-color);
            background: #f1f2f6;
        }

        .correct { background: #dff9fb !important; border-color: var(--success) !important; color: #009432; }
        .wrong { background: #ffeaa7 !important; border-color: var(--error) !important; color: #d63031; }

        .nav-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            font-family: inherit;
        }

        .btn-prev { background: #ced4da; color: #495057; }
        .btn-next { background: var(--secondary-color); color: white; }
        .btn-start { background: var(--primary-gradient); color: white; width: 100%; }

        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        #feedback {
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            min-height: 24px;
        }

        .rationale {
            font-size: 14px;
            color: #57606f;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            margin-top: 5px;
            border-left: 3px solid #ffa502;
        }
    </style>
</head>
<body>

<div class="quiz-card">
    <h1>தமிழ் வினாடி-வினா</h1>

    <div id="home-screen">
        <p style="text-align:center; color:#57606f;">30-க்கும் மேற்பட்ட தலைப்புகளில் இருந்து வினாக்கள் சுழற்சி முறையில் கேட்கப்படும்.</p>
        <button class="btn btn-start" onclick="initQuiz()">பயிற்சியைத் தொடங்கு</button>
    </div>

    <div id="quiz-screen" style="display:none;">
        <div class="stats-bar">
            <span>சரியானது: <span id="score-val">0</span></span>
            <span>வினா: <span id="current-idx">0</span> / <span id="total-limit">10</span></span>
        </div>

        <div class="meta-info">
            <span id="cat-display"></span> | <span id="title-display"></span>
        </div>

        <div id="q-area">
            <div id="q-text"></div>
            <div id="options-area"></div>
            <div id="feedback"></div>
        </div>

        <div class="nav-controls">
            <button id="prev-btn" class="btn btn-prev" onclick="changeQuestion(-1)">முந்தைய</button>
            <button id="next-btn" class="btn btn-next" onclick="changeQuestion(1)">அடுத்த வினா</button>
        </div>
    </div>
</div>

<script src="data.js"></script>
<script>
    let allQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let answeredQuestions = new Set();

    async function initQuiz() {
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        
        // 1. அனைத்து கோப்புகளிலிருந்தும் வினாக்களைத் திரட்டுதல்
        let tempQuestions = [];
        
        // காண்பிக்கும் வேகத்திற்காக ஒரு 5-10 ரேண்டம் கோப்புகளை மட்டும் எடுக்கலாம்
        // அல்லது அனைத்து 30+ கோப்புகளையும் எடுக்கலாம். இங்கே அனைத்தும் எடுக்கப்படுகிறது.
        for (let cat of masterData) {
            for (let qz of cat.quizzes) {
                try {
                    const res = await fetch(qz.file);
                    const data = await res.json();
                    const qs = Array.isArray(data) ? data : (data.questions || []);
                    // ஒவ்வொரு வினாவிலும் அதன் கேட்டகிரி தகவலைச் சேர்த்தல்
                    qs.forEach(item => {
                        item.sourceCat = cat.category;
                        item.sourceTitle = qz.title;
                        tempQuestions.push(item);
                    });
                } catch(e) { console.log("Error loading:", qz.file); }
            }
        }

        // 2. வினாக்களை ரேண்டமாக கலக்குதல் (Shuffle)
        allQuestions = tempQuestions.sort(() => Math.random() - 0.5);
        
        // முதல் 50 வினாக்களை மட்டும் பயிற்சியில் வைக்கலாம் (வேகத்திற்காக)
        allQuestions = allQuestions.slice(0, 50); 
        
        currentIndex = 0;
        updateUI();
    }

    function updateUI() {
        const q = allQuestions[currentIndex];
        document.getElementById('current-idx').innerText = currentIndex + 1;
        document.getElementById('total-limit').innerText = allQuestions.length;
        document.getElementById('cat-display').innerText = q.sourceCat;
        document.getElementById('title-display').innerText = q.sourceTitle;
        document.getElementById('q-text').innerText = q.question;
        document.getElementById('feedback').innerText = "";
        
        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = "";

        const opts = q.answerOptions || [];
        opts.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            
            // ஏற்கனவே விடையளித்திருந்தால் முடிவுகளைக் காட்ட
            if(answeredQuestions.has(currentIndex)) {
                btn.disabled = true;
                if(opt.isCorrect) btn.classList.add('correct');
            }

            btn.onclick = () => handleAnswer(btn, opt, q);
            optionsArea.appendChild(btn);
        });

        // முந்தைய பொத்தான் கட்டுப்பாடு
        document.getElementById('prev-btn').disabled = (currentIndex === 0);
        document.getElementById('next-btn').innerText = (currentIndex === allQuestions.length - 1) ? "முடிக்க" : "அடுத்த வினா";
    }

    function handleAnswer(btn, selectedOpt, question) {
        if(answeredQuestions.has(currentIndex)) return;
        
        answeredQuestions.add(currentIndex);
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if(selectedOpt.isCorrect) {
            btn.classList.add('correct');
            document.getElementById('feedback').innerText = "✅ சரியான விடை!";
            document.getElementById('feedback').style.color = "var(--success)";
            score++;
            document.getElementById('score-val').innerText = score;
        } else {
            btn.classList.add('wrong');
            document.getElementById('feedback').innerText = "❌ தவறான விடை!";
            document.getElementById('feedback').style.color = "var(--error)";
            // சரியான விடையைக் காண்பித்தல்
            question.answerOptions.forEach((o, i) => {
                if(o.isCorrect) allBtns[i].classList.add('correct');
            });
        }

        if(selectedOpt.rationale) {
            const rDiv = document.createElement('div');
            rDiv.className = 'rationale';
            rDiv.innerText = "விளக்கம்: " + selectedOpt.rationale;
            btn.appendChild(rDiv);
        }
    }

    function changeQuestion(step) {
        currentIndex += step;
        if(currentIndex >= 0 && currentIndex < allQuestions.length) {
            updateUI();
        } else if (currentIndex >= allQuestions.length) {
            alert("பயிற்சி முடிந்தது! உங்கள் மதிப்பெண்: " + score);
            location.reload();
        }
    }
</script>

</body>
</html>
