<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>தமிழ் வினாடி-வினா களஞ்சியம்</title>
    <style>
        :root { --primary: #1a73e8; --bg: #f0f2f5; --success: #28a745; --error: #dc3545; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .quiz-container { background: white; width: 100%; max-width: 600px; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); text-align: center; font-size: 22px; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .score-board { text-align: center; font-weight: bold; margin-bottom: 15px; color: #5f6368; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #eee; }
        .meta-info { background: #e8f0fe; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid var(--primary); font-size: 14px; }
        #q-text { color: #202124; line-height: 1.5; font-size: 18px; margin-bottom: 20px; }
        .option-btn { display: block; width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #dadce0; border-radius: 8px; background: white; cursor: pointer; text-align: left; font-size: 16px; transition: all 0.2s ease; }
        .option-btn:hover:not([disabled]) { background-color: #f1f3f4; border-color: var(--primary); }
        .correct { background-color: #d4edda !important; border-color: var(--success) !important; color: #155724; font-weight: bold; }
        .wrong { background-color: #f8d7da !important; border-color: var(--error) !important; color: #721c24; }
        .rationale { font-size: 14px; margin-top: 5px; color: #555; font-style: italic; }
        .btn-action { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; margin-top: 15px; }
        #feedback { text-align: center; margin-top: 15px; font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>

<div class="quiz-container">
    <h1>தமிழ் வினாடி-வினா</h1>
    
    <div id="start-ui">
        <p style="text-align:center;">உங்கள் 30+ தலைப்புகளிலிருந்து தன்னிச்சையாக வினாக்கள் கேட்கப்படும்.</p>
        <button class="btn-action" onclick="pickRandomQuiz()">வினாடியைத் தொடங்கு</button>
    </div>

    <div id="quiz-ui" style="display:none;">
        <div class="score-board">
            சரியான பதில்கள்: <span id="score">0</span> / <span id="total">0</span>
        </div>
        <div class="meta-info">
            <div id="cat-name" style="font-weight: bold; color: var(--primary);"></div>
            <div id="quiz-title" style="margin-top: 4px; color: #555;"></div>
        </div>
        <div id="q-text">வினா ஏற்றப்படுகிறது...</div>
        <div id="options-area"></div>
        <div id="feedback"></div>
        <button id="next-btn" class="btn-action" onclick="pickRandomQuiz()" style="display:none;">அடுத்த வினாத்தாள்</button>
    </div>
</div>

<script src="data.js"></script>

<script>
    let score = 0;
    let totalQuestionsCount = 0;

    async function pickRandomQuiz() {
        document.getElementById('start-ui').style.display = 'none';
        document.getElementById('quiz-ui').style.display = 'block';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback').innerText = "";
        document.getElementById('options-area').innerHTML = "";
        
        const category = masterData[Math.floor(Math.random() * masterData.length)];
        const quiz = category.quizzes[Math.floor(Math.random() * category.quizzes.length)];

        document.getElementById('cat-name').innerText = "பிரிவு: " + category.category;
        document.getElementById('quiz-title').innerText = "தலைப்பு: " + quiz.title;

        try {
            const res = await fetch(quiz.file);
            const data = await res.json();
            const questionsArray = Array.isArray(data) ? data : (data.questions || []);
            const randomQ = questionsArray[Math.floor(Math.random() * questionsArray.length)];
            displayQuestion(randomQ);
        } catch (err) {
            document.getElementById('q-text').innerText = "பிழை: கோப்பை ஏற்ற முடியவில்லை.";
            document.getElementById('next-btn').style.display = 'block';
        }
    }

    function displayQuestion(q) {
        document.getElementById('q-text').innerText = q.question;
        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = "";

        // உங்கள் JSON-ல் உள்ள 'answerOptions' ஐப் பயன்படுத்துகிறோம்
        const options = q.answerOptions || [];

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = `<div>${opt.text}</div>`;
            
            btn.onclick = () => {
                totalQuestionsCount++;
                document.getElementById('total').innerText = totalQuestionsCount;
                
                // அனைத்து பட்டன்களையும் முடக்கு
                const allButtons = document.querySelectorAll('.option-btn');
                allButtons.forEach(b => b.disabled = true);

                if (opt.isCorrect) {
                    btn.classList.add('correct');
                    document.getElementById('feedback').innerText = "✅ மிகச் சரி!";
                    document.getElementById('feedback').style.color = "var(--success)";
                    score++;
                    document.getElementById('score').innerText = score;
                } else {
                    btn.classList.add('wrong');
                    document.getElementById('feedback').innerText = "❌ தவறு!";
                    document.getElementById('feedback').style.color = "var(--error)";
                    
                    // சரியான விடையைக் காட்டு
                    options.forEach((o, index) => {
                        if(o.isCorrect) allButtons[index].classList.add('correct');
                    });
                }

                // விளக்கத்தைக் காட்ட (Rationale)
                if(opt.rationale) {
                    const ratDiv = document.createElement('div');
                    ratDiv.className = 'rationale';
                    ratDiv.innerText = "விளக்கம்: " + opt.rationale;
                    btn.appendChild(ratDiv);
                }
                
                document.getElementById('next-btn').style.display = 'block';
            };
            optionsArea.appendChild(btn);
        });
    }
</script>
</body>
</html>
